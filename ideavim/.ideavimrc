" IDEAVim Specific settings
set visualbell
set ideajoin
set idearefactormode=keep
" :w writes all files
set ideawrite=all
set showmode
set showcmd
nnoremap [[ :action MethodUp<CR>zz
nnoremap ]] :action MethodDown<CR>zz

" autocmd 
" augroup vimrc-incsearch-highlight-undo
"     autocmd!
"     autocmd CmdlineEnter /,\? :set hlsearch
"     autocmd CmdlineLeave /,\? :set nohlsearch
" augroup END

" Disable automatic comment insertion
autocmd FileType * setlocal formatoptions-=c formatoptions-=r formatoptions-=o



" options
let mapleader = " "

set relativenumber
set number
set clipboard+=unnamedplus
set clipboard+=ideaput
set hlsearch
set incsearch
set scroll=20 " Scroll X lines using Ctrl-d/Ctrl-u
set scrolloff=5 " Keep X lines above/below cursor when scrolling
set iskeyword+=- " Treat dash separated words as a word text object



" keymaps
" allow single line travel when lines visually wrap
" nnoremap j gj
" nnoremap k gk
" move hightlighted text up/down in different modes
nnoremap <leader>j :m .+1<CR>==
nnoremap <leader>k :m .-2<CR>==
inoremap <c-j> <esc>:m .+1<CR>==gi
inoremap <c-k> <esc>:m .-2<CR>==gi
xmap J <Action>(MoveLineDown)
xmap K <Action>(MoveLineUp)

" toggle ignorecase
nnoremap <F2> :set ignorecase! ignorecase?<cr>
nnoremap <c-c> <esc>

" exit insert mode whenever you type 'jk' or 'kj'
inoremap kj <esc>
inoremap jk <esc>

" delete without yanking
nnoremap <leader>d "_d
vnoremap <leader>d "_d
nnoremap <leader>D "_D
nnoremap <leader>C "_C
nnoremap <leader>c "_c
nnoremap <leader>x "_x

" replace currently selected text with default register without yanking
vnoremap p "_dP
" ???
" nnoremap <leader>x "_dx

" wtf?????????????????????????????????????????????????????????????????????
nnoremap Y y$
nnoremap n nzzzv
nnoremap N Nzzzv
" ???
nnoremap <leader>J mzJ`z
" break undo sequence using punctuation marks
" TODO fix bug
" inoremap , ,<c-g>u
" inoremap . .<c-g>u
" inoremap ! !<c-g>u
" inoremap ? ?<c-g>u

" make vim behave
" D duplicates highlighted below
vnoremap D y'>p
" tab while code selected
vnoremap < <gv
vnoremap > >gv

" IDEA SPECIFIC settings (refactored from nvim)
" splits
nnoremap sh <Action>(PrevSplitter)
nnoremap sl <Action>(NextSplitter)
nnoremap sv <Action>(SplitVertically)
nnoremap ss <Action>(SplitHorizontally)

" navigate buffer
nnoremap <tab> <Action>(NextTab)
" nnoremap <tab> <Action>(Forward)
nnoremap <s-tab> <Action>(PreviousTab)
" nnoremap <s-tab> <Action>(Back)

" nnoremap :bd <Action>(CloseContent)
" nnoremap :term <Action>(ActivateTerminalToolWindow)



" diagnostics
nnoremap <leader>e <Action>(ShowErrorDescription)
nnoremap [d <Action>(GotoPreviousError)
nnoremap ]d <Action>(GotoNextError)
" vim.api.nvim_set_keymap('n', '<leader>q', '<cmd>lua vim.diagnostic.setloclist()<CR>', opts)

" Telescope | ff -> find file | fg -> find grep | fb -> find buffer
" Telescope | dl -> diagnostics list | fa -> find all
nnoremap <leader>ff <Action>(GotoFile)
" SearchEverywhere
nnoremap <leader>fg <Action>(FindInPath)
nnoremap <leader>fb <Action>(RecentFiles)
" map('n', '<leader>fh', "<cmd>lua require('telescope.builtin').help_tags()<cr>", opts)
nnoremap <leader>fd <Action>(ActivateProblemsViewToolWindow)
nnoremap <leader>fa <Action>(FindUsages)

" " lsp.lua
" vim.api.nvim_buf_set_keymap(bufnr, 'n', 'K', '<cmd>lua vim.lsp.buf.hover()<CR>', opts)
nnoremap gd <Action>(GotoDeclaration)
nnoremap gD <Action>(GotoDeclaration)
" vim.api.nvim_buf_set_keymap(bufnr, 'n', 'gD', '<cmd>lua vim.lsp.buf.declaration()<CR>', opts)
nnoremap gt <Action>(GotoTypeDeclaration)
nnoremap gi <Action>(GotoImplementation)
" vim.api.nvim_buf_set_keymap(bufnr, 'n', 'gr', '<cmd>lua vim.lsp.buf.references()<CR>', opts)
" vim.api.nvim_buf_set_keymap(bufnr, 'n', '<c-k>', '<cmd>lua vim.lsp.buf.signature_help()<CR>', opts)
nnoremap <leader>R <Action>(RenameElement)
nnoremap <leader>ca <Action>(ShowIntentionActions)
nnoremap <leader>fm <Action>(ShowReformatFileDialog)
vmap <leader>fm <Action>(ShowReformatFileDialog)
nnoremap <leader>fi <Action>(OptimizeImports)
nnoremap <leader>fsv <Action>(Toolkit.GotoService)
nnoremap <F1> <Action>(ShowReformatFileDialog)

nnoremap <leader>r :action Refactorings.QuickListPopupAction<CR>
xnoremap <leader>r :action Refactorings.QuickListPopupAction<CR>
nnoremap <leader>tc :action RunCoverage<CR>
nnoremap <leader>tC gg:action MethodDown<CR>zz:action RunCoverage<CR>
nnoremap <leader>fc :action HideAllWindows<CR>
nnoremap <leader>gb :action Annotate<CR>
xmap <leader>gb :action Annotate<CR>


" plugins
Plug 'tpope/vim-surround'
Plug 'tpope/vim-commentary'
Plug 'machakann/vim-highlightedyank'
let g:highlightedyank_highlight_duration = 50 " time in milliseconds
let g:highlightedyank_highlight_color = "rgba(255, 195, 0, 100)"
Plug 'dbakker/vim-paragraph-motion'

